function rotate_x(b,e,a){var d=a[1]-b[1];var c=b[2]-a[2];a[1]=b[1]+d*e[1]+c*e[0];a[2]=b[2]-c*e[1]+d*e[0]}function rotate_x_normal(c,a){var b=a[1];a[1]=b*c[1]-a[2]*c[0];a[2]=a[2]*c[1]+b*c[0]}function rotate_y(b,e,a){var d=a[0]-b[0];var c=a[2]-b[2];a[0]=b[0]+d*e[1]+c*e[0];a[2]=b[2]+c*e[1]-d*e[0]}function rotate_y_normal(c,a){var b=a[0];a[0]=b*c[1]+a[2]*c[0];a[2]=a[2]*c[1]-b*c[0]}function rotate_z(b,e,a){var d=a[0]-b[0];var c=a[1]-b[1];a[0]=b[0]+d*e[1]-c*e[0];a[1]=b[1]+c*e[1]+d*e[0]}function rotate_z_normal(c,a){var b=a[0];a[0]=b*c[1]-a[1]*c[0];a[1]=a[1]*c[1]+b*c[0]}function get_rotation_parameter(a,h,b){var q=new Array();var i=h[0]*h[0];var l=h[1]*h[1];var m=h[2]*h[2];var d=(l+m);var j=(i+m);var c=(i+l);var g=a[1]*h[1]+a[2]*h[2];var k=a[0]*h[0]+a[2]*h[2];var f=a[0]*h[0]+a[1]*h[1];var e=a[1]*h[2]-a[2]*h[1];var p=a[2]*h[0]-a[0]*h[2];var o=a[0]*h[1]-a[1]*h[0];var n=l+i+m;q[0]=n;q[1]=d;q[2]=j;q[3]=c;q[4]=a[0]*d;q[5]=a[1]*j;q[6]=a[2]*c;q[7]=g;q[8]=k;q[9]=f;q[10]=Math.cos(b);q[11]=Math.sin(b)*Math.sqrt(n);q[12]=e;q[13]=p;q[14]=o;q[15]=a[0];q[16]=a[1];q[17]=a[2];q[18]=h[0];q[19]=h[1];q[20]=h[2];return q}function rotate(f,b){var c=f[20]*b[2];var d=f[19]*b[1];var g=f[18]*b[0];var e=g+d+c;var a=b[0];var h=b[1];b[0]=(f[4]+f[18]*(-f[7]+e)+((a-f[15])*f[1]+f[18]*(f[7]-d-c))*f[10]+f[11]*(f[12]-f[20]*h+f[19]*b[2]))/f[0];b[1]=(f[5]+f[19]*(-f[8]+e)+((h-f[16])*f[2]+f[19]*(f[8]-g-c))*f[10]+f[11]*(f[13]+f[20]*a-f[18]*b[2]))/f[0];b[2]=(f[6]+f[20]*(-f[9]+e)+((b[2]-f[17])*f[3]+f[20]*(f[9]-g-d))*f[10]+f[11]*(f[14]-f[19]*a+f[18]*h))/f[0]}function translate(b,a){a[0]=a[0]+b[0];a[1]=a[1]+b[1];a[2]=a[2]+b[2]}function scale(b,a){a[0]=a[0]*b[0];a[1]=a[1]*b[1];a[2]=a[2]*b[2]}function translate_solid(b,a){translate(b,a.center);for(var c=0;c<a.points_number;c++){translate(b,a.points[c])}}function translate_solid_direction(b,d,a){translate([b[0]*d,b[1]*d,b[2]*d],a.center);for(var c=0;c<a.points_number;c++){translate([b[0]*d,b[1]*d,b[2]*d],a.points[c])}}function scale_solid(d,c){var e=c.center;var b=[-c.center[0],-c.center[1],-c.center[2]];translate_solid(b,c);for(var f=0;f<c.points_number;f++){scale(d,c.points[f])}translate_solid(e,c)}function rotate_solid(a,c,f,b){parametri=get_rotation_parameter(a,c,f);parametri2=get_rotation_parameter([0,0,0],c,f);rotate(parametri,b.center);rotate(parametri2,b.axis_x);rotate(parametri2,b.axis_y);rotate(parametri2,b.axis_z);for(var e=0;e<b.faces_number;e++){rotate(parametri2,b.normals[e])}for(var d=0;d<b.points_number;d++){rotate(parametri,b.points[d])}}function rotate_solid_fast(c,b,a){rotate(c,a.center);rotate(b,a.axis_x);rotate(b,a.axis_y);rotate(b,a.axis_z);for(var e=0;e<a.faces_number;e++){rotate(b,a.normals[e])}for(var d=0;d<a.points_number;d++){rotate(c,a.points[d])}}function rotate_solid_x(a,f,b){var e=[Math.sin(f),Math.cos(f)];rotate_x(a,e,b.center);rotate_x_normal(e,b.axis_x);rotate_x_normal(e,b.axis_y);rotate_x_normal(e,b.axis_z);for(var d=0;d<b.faces_number;d++){rotate_x_normal(e,b.normals[d])}for(var c=0;c<b.points_number;c++){rotate_x(a,e,b.points[c])}}function rotate_solid_y(a,f,b){var e=[Math.sin(f),Math.cos(f)];rotate_y(a,e,b.center);rotate_y_normal(e,b.axis_x);rotate_y_normal(e,b.axis_y);rotate_y_normal(e,b.axis_z);for(var d=0;d<b.faces_number;d++){rotate_y_normal(e,b.normals[d])}for(var c=0;c<b.points_number;c++){rotate_y(a,e,b.points[c])}}function rotate_solid_z(a,f,b){var e=[Math.sin(f),Math.cos(f)];rotate_z(a,e,b.center);rotate_z_normal(e,b.axis_x);rotate_z_normal(e,b.axis_y);rotate_z_normal(e,b.axis_z);for(var d=0;d<b.faces_number;d++){rotate_z_normal(e,b.normals[d])}for(var c=0;c<b.points_number;c++){rotate_z(a,e,b.points[c])}}function project(c,b){var a=new Array();a[0]=b[0]*c/b[2];a[1]=-b[1]*c/b[2];a[2]=c;return a}function isPointInPoly(e,f){for(var g=false,d=-1,a=e.length,b=a-1;++d<a;b=d){((e[d].y<=f.y&&f.y<e[b].y)||(e[b].y<=f.y&&f.y<e[d].y))&&(f.x<(e[b].x-e[d].x)*(f.y-e[d].y)/(e[b].y-e[d].y)+e[d].x)&&(g=!g)}return g};

function get_triangle_normal(e,d,c){var b=new Array(3);var a=new Array(3);var f=new Array(3);a[0]=d[0]-e[0];a[1]=d[1]-e[1];a[2]=d[2]-e[2];f[0]=c[0]-e[0];f[1]=c[1]-e[1];f[2]=c[2]-e[2];b[0]=a[1]*f[2]-a[2]*f[1];b[1]=-(a[0]*f[2]-a[2]*f[0]);b[2]=a[0]*f[1]-a[1]*f[0];return b}function get_triangle(d,c,b){var a=new Array(2,3);a[0][1]=d;a[0][2]=c;a[0][3]=b;a[1]=get_triangle_normal(d,c,b);return a}function get_quadrilateral_normal(e,d,c,b){var a=new Array(2,3);a[0]=get_triangle_normal(e,d,b);a[1]=get_triangle_normal(d,c,b);return a}function get_quadrilateral(e,d,c,b){var a=new Array(2,2,3,3);a[0][0][0]=e;a[0][0][1]=d;a[0][0][2]=c;a[0][1][0]=d;a[0][1][1]=c;a[0][1][2]=b;a[1]=get_quadrilater_normal(e,d,c,b)}var faces={left:"left",right:"right",top:"top",bottom:"bottom",front:"front",back:"back"};function facedPlane(d,c,a,l){var m=[-0.5*c,-0.5*c,0.5*c];var k=[0.5*c,-0.5*c,0.5*c];var j=[0.5*c,0.5*c,0.5*c];var i=[-0.5*c,0.5*c,0.5*c];var h=[-0.5*c,-0.5*c,-0.5*c];var g=[0.5*c,-0.5*c,-0.5*c];var f=[0.5*c,0.5*c,-0.5*c];var e=[-0.5*c,0.5*c,-0.5*c];var b={left:function(){return[h,m,i,e]},right:function(){return[k,g,f,j]},top:function(){return[i,j,f,e]},bottom:function(){return[m,h,g,k]},front:function(){return[m,k,j,i]},back:function(){return[g,h,e,f]}};this.points=b[d]();this.faces=[[0,1,2,3]];this.normals=[{left:[-1,0,0],right:[1,0,0],top:[0,1,0],bottom:[0,-1,0],front:[0,0,1],back:[0,0,-1]}[d]];this.center=[92,92,92,1];this.points_number=this.points.length;this.faces_number=this.faces.length;this.vertex_number=4;this.axis_x=[1,0,0];this.axis_y=[0,1,0];this.axis_z=[0,0,1];this.fillcolor=a;this.linecolor=l}function cube(g,m){var p={left:[],right:[],top:[],bottom:[],front:[],back:[]};var o={x:-g.center.x-g.size.x/2,y:-g.center.y-g.size.y/2,z:-g.center.z-g.size.z/2};var f=[92,92,92,1];var c=[0,0,0,0.3];var n,a;for(var e=0;e<g.size.x*m.scale;e++){for(var d=0;d<g.size.y*m.scale;d++){a={x:(g.texture.x+g.size.x+2*g.size.z)*m.scale+(g.texture.mirror?g.size.x*m.scale-e-1:e),y:(g.texture.y+g.size.z)*m.scale+d};if(m){c=m[a.x][a.y]}n=new facedPlane(faces.back,1/m.scale,c,f);translate_solid([o.x+e/m.scale,-o.y-d/m.scale,-100+o.z],n);n.map=a;p.back.push(n);a={x:(g.texture.x+g.size.z)*m.scale+(g.texture.mirror?g.size.x*m.scale-e-1:e),y:(g.texture.y+g.size.z)*m.scale+d};if(m){c=m[a.x][a.y]}n=new facedPlane(faces.front,1/m.scale,c,f);translate_solid([o.x+e/m.scale,-o.y-d/m.scale,-100+o.z+g.size.z-1/m.scale],n);n.map=a;p.front.push(n)}}for(var e=0;e<g.size.z*m.scale;e++){for(var d=0;d<g.size.y*m.scale;d++){var l={x:(g.texture.x)*m.scale+e,y:(g.texture.y+g.size.z)*m.scale+d};var h={x:(g.texture.x+2*g.size.z+g.size.x)*m.scale-e-1,y:(g.texture.y+g.size.z)*m.scale+d};a=g.texture.mirror?h:l;if(m){c=m[a.x][a.y]}n=new facedPlane(faces.left,1/m.scale,c||[255,255,255,1],f);translate_solid([o.x+0.01,-o.y-d/m.scale,-100+o.z+e/m.scale],n);n.map=a;p.left.push(n);a=g.texture.mirror?l:h;if(m){c=m[a.x][a.y]}n=new facedPlane(faces.left,1/m.scale,c||[255,255,255,1],f);translate_solid([o.x+g.size.x,-o.y-d/m.scale,-100+o.z+e/m.scale],n);n.map=a;p.right.push(n)}}for(var e=0;e<g.size.x*m.scale;e++){for(var b=0;b<g.size.z*m.scale;b++){a={x:(g.texture.x+g.size.z)*m.scale+(g.texture.mirror?g.size.x*m.scale-e-1:e),y:(g.texture.y)*m.scale+b};if(m){c=m[a.x][a.y]}n=new facedPlane(faces.top,1/m.scale,c||[255,255,255,1],f);translate_solid([o.x+e/m.scale,-o.y,-100+o.z+b/m.scale],n);n.map=a;p.top.push(n);a={x:(g.texture.x+g.size.z+g.size.x)*m.scale+(g.texture.mirror?g.size.x*m.scale-e-1:e),y:(g.texture.y)*m.scale+b};if(m){m[a.x][a.y]}n=new facedPlane(faces.bottom,1/m.scale,c||[255,255,255,1],f);translate_solid([o.x+e/m.scale,-o.y-g.size.y+1,-100+o.z+b/m.scale],n);n.map=a;p.bottom.push(n)}}return p}function headCubes(b){var e={left:[],right:[],top:[],bottom:[],front:[],back:[]};for(var d=0;d<8;d++){for(var c=0;c<8;c++){var a=new facedPlane(faces.left,1,[255,255,255,1],b||[92,92,92,1]);translate_solid([0,d,-100+c],a);a.map={x:c,y:15-d};e.left.push(a);a=new facedPlane(faces.right,1,[255,255,255,1],b||[92,92,92,1]);translate_solid([7,d,-100+c],a);a.map={x:23-c,y:15-d};e.right.push(a);a=new facedPlane(faces.top,1,[255,255,255,1],b||[92,92,92,1]);translate_solid([d,7,-100+c],a);a.map={x:8+d,y:c};e.top.push(a);a=new facedPlane(faces.bottom,1,[255,255,255,1],b||[92,92,92,1]);translate_solid([d,0,-100+c],a);a.map={x:16+d,y:c};e.bottom.push(a);a=new facedPlane(faces.back,1,[255,255,255,1],b||[92,92,92,1]);translate_solid([d,c,-100],a);a.map={x:24+d,y:15-c};e.back.push(a);a=new facedPlane(faces.front,1,[255,255,255,1],b||[92,92,92,1]);translate_solid([d,c,-100+7],a);a.map={x:8+d,y:15-c};e.front.push(a)}}return e}function hatCubes(a,c){var h={left:[],right:[],top:[],bottom:[],front:[],back:[]};var l=1.2;if(!a){a=1}for(var d=0;d<8;d++){for(var b=0;b<8;b++){var f=d*l;var e=b*l;var k=(l-1)*4;var g=new facedPlane(faces.left,l,c||[0,0,0,a],[255,255,255,1,a]);translate_solid([0,f,-100+e],g);translate_solid([-k,-k,-k],g);g.map={x:32+b,y:15-d};h.left.push(g);g=new facedPlane(faces.right,l,c||[0,0,0,a],[255,255,255,1,a]);translate_solid([7*l,f,-100+e],g);translate_solid([-k,-k,-k],g);g.map={x:(32+23)-b,y:15-d};h.right.push(g);g=new facedPlane(faces.top,l,c||[0,0,0,a],[255,255,255,1,a]);translate_solid([f,7*l,-100+e],g);translate_solid([-k,-k,-k],g);g.map={x:(32+8)+d,y:b};h.top.push(g);g=new facedPlane(faces.bottom,l,c||[0,0,0,a],[255,255,255,1,a]);translate_solid([f,0,-100+e],g);translate_solid([-k,-k,-k],g);g.map={x:(32+16)+d,y:b};h.bottom.push(g);g=new facedPlane(faces.back,l,c||[0,0,0,a],[255,255,255,1,a]);translate_solid([f,e,-100,a],g);translate_solid([-k,-k,-k],g);g.map={x:(32+24)+d,y:15-b};h.back.push(g);g=new facedPlane(faces.front,l,c||[0,0,0,a],[255,255,255,1,a]);translate_solid([f,e,-100+7*l],g);translate_solid([-k,-k,-k],g);g.map={x:(32+8)+d,y:15-b};h.front.push(g)}}return h}function bodyCubes(c){var a={left:[],right:[],top:[],bottom:[],front:[],back:[]};for(var e=0;e<12;e++){for(var d=0;d<8;d++){var b=new facedPlane(faces.back,1,c||[255,255,255,1],[92,92,92,1]);translate_solid([d,e-12,-100+2],b);b.map={x:39-d,y:31-e};a.back.push(b);b=new facedPlane(faces.front,1,c||[255,255,255,1],[92,92,92,1]);translate_solid([d,e-12,-100+3+2],b);b.map={x:20+d,y:31-e};a.front.push(b)}}for(var e=0;e<12;e++){for(var d=0;d<4;d++){var b=new facedPlane(faces.left,1,c||[255,255,255,1],[92,92,92,1]);translate_solid([0.01,e-12,-100+2+d],b);b.map={x:16+d,y:31-e};a.left.push(b);b=new facedPlane(faces.left,1,c||[255,255,255,1],[92,92,92,1]);translate_solid([8.01,e-12,-100+2+d],b);b.map={x:31-d,y:31-e};a.right.push(b)}}for(var e=0;e<8;e++){for(var d=0;d<4;d++){var b=new facedPlane(faces.top,1,c||[255,255,255,1],[92,92,92,1]);translate_solid([e,-1.01,-100+2+d],b);b.map={x:20+e,y:16+d};a.top.push(b);b=new facedPlane(faces.bottom,1,c||[255,255,255,1],[92,92,92,1]);translate_solid([e,-12,-100+2+d],b);b.map={x:28+e,y:16+d};a.bottom.push(b)}}return a}function legCubes(b){var e={left:{left:[],right:[],top:[],bottom:[],front:[],back:[]},right:{left:[],right:[],top:[],bottom:[],front:[],back:[]}};for(var d=0;d<12;d++){for(var c=0;c<4;c++){var a=new facedPlane(faces.back,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([c,d-12-12,-100+2],a);a.map={x:15-c,y:31-d};e.left.back.push(a);a=new facedPlane(faces.front,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([c,d-12-12,-100+2+3],a);a.map={x:4+c,y:31-d};e.left.front.push(a);a=new facedPlane(faces.back,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([7-c,d-12-12,-100+2],a);e.right.back.push(a);a=new facedPlane(faces.front,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([7-c,d-12-12,-100+2+3],a);e.right.front.push(a);a=new facedPlane(faces.left,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([0,d-12-12,-100+2+c],a);a.map={x:c,y:31-d};e.left.left.push(a);a=new facedPlane(faces.right,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([3,d-12-12,-100+2+c],a);a.map={x:11-c,y:31-d};e.left.right.push(a);a=new facedPlane(faces.left,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([4,d-12-12,-100+2+c],a);e.right.right.push(a);a=new facedPlane(faces.right,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([4+3.01,d-12-12,-100+2+c],a);e.right.left.push(a)}}for(var d=0;d<4;d++){for(var c=0;c<4;c++){var a=new facedPlane(faces.top,1,[255,255,255,1],[92,92,92,1]);translate_solid([c,-13.01,-100+2+d],a);a.map={x:4+c,y:16+d};e.left.top.push(a);a=new facedPlane(faces.bottom,1,[255,255,255,1],[92,92,92,1]);translate_solid([c,-12-12,-100+2+d],a);a.map={x:8+c,y:16+d};e.left.bottom.push(a);a=new facedPlane(faces.top,1,[255,255,255,1],[92,92,92,1]);translate_solid([7-c,-13.01,-100+2+d],a);e.right.top.push(a);a=new facedPlane(faces.bottom,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([7-c,-12-12,-100+2+d],a);e.right.bottom.push(a)}}return e}function armCubes(b){var e={left:{left:[],right:[],top:[],bottom:[],front:[],back:[]},right:{left:[],right:[],top:[],bottom:[],front:[],back:[]}};for(var d=0;d<12;d++){for(var c=0;c<4;c++){var a=new facedPlane(faces.back,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([c-4,d-12,-100+2],a);a.map={x:55-c,y:31-d};e.left.back.push(a);a=new facedPlane(faces.front,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([c-4,d-12,-100+2+3],a);a.map={x:44+c,y:31-d};e.left.front.push(a);a=new facedPlane(faces.back,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([7-c+4,d-12,-100+2],a);e.right.back.push(a);a=new facedPlane(faces.front,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([11-c,d-12,-100+2+3],a);e.right.front.push(a);a=new facedPlane(faces.left,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([-4,d-12,-100+2+c],a);a.map={x:40+c,y:31-d};e.left.left.push(a);a=new facedPlane(faces.right,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([3-4,d-12,-100+2+c],a);a.map={x:51-c,y:31-d};e.left.right.push(a);a=new facedPlane(faces.left,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([4+4,d-12,-100+2+c],a);e.right.right.push(a);a=new facedPlane(faces.right,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([4+3+4,d-12,-100+2+c],a);e.right.left.push(a)}}for(var d=0;d<4;d++){for(var c=0;c<4;c++){var a=new facedPlane(faces.top,1,[255,255,255,1],[92,92,92,1]);translate_solid([c-4,-1,-100+2+d],a);a.map={x:44+c,y:16+d};e.left.top.push(a);a=new facedPlane(faces.bottom,1,[255,255,255,1],[92,92,92,1]);translate_solid([c-4,-12,-100+2+d],a);a.map={x:48+c,y:16+d};e.left.bottom.push(a);a=new facedPlane(faces.top,1,[255,255,255,1],[92,92,92,1]);translate_solid([11-c,-1,-100+2+d],a);e.right.top.push(a);a=new facedPlane(faces.bottom,1,b||[255,255,255,1],[92,92,92,1]);translate_solid([11-c,-12,-100+2+d],a);e.right.bottom.push(a)}}return e}
function itemCubes(itemData,flip){var item={left:[],right:[],top:[],bottom:[],front:[],back:[]};var i=0,j=0,size=0.75,index,color,cubo,alpha;for(i=0;i<16;i++){for(j=0;j<16;j++){index=flip?(i+ j*itemData.width)*4:(j+(15- i)*itemData.width)*4;alpha=itemData.data[index+3];if(alpha==0)continue;color=[itemData.data[index+0],itemData.data[index+1],itemData.data[index+2],alpha];cubo=new facedPlane(faces.right,size,color,color);translate_solid([3- 5,4+ i*size- 16*size,-94+ 20*size- j*size],cubo);rotate_solid_x([0,0,-98],Math.PI/4,cubo);item.right.push(cubo);cubo=new facedPlane(faces.left,size,color,color);translate_solid([3- 5,4+ i*size- 16*size,-94+ 20*size- j*size],cubo);rotate_solid_x([0,0,-98],Math.PI/4,cubo);item.left.push(cubo);}}
for(i=0;i<16;i++){alpha=0;j=-1;index;while(j<16){while(++j<16&&alpha==0){index=flip?(i+ j*itemData.width)*4:(j+(15- i)*itemData.width)*4;alpha=itemData.data[index+3];}
if(alpha>0){color=[itemData.data[index+0],itemData.data[index+1],itemData.data[index+2],alpha];cubo=new facedPlane(faces.front,size,color,color);translate_solid([3- 5,4+ i*size- 16*size,-94+ 21*size- j*size],cubo);rotate_solid_x([0,0,-98],Math.PI/4,cubo);item.front.push(cubo);do{index=flip?(i+ j*itemData.width)*4:(j+(15- i)*itemData.width)*4;alpha=itemData.data[index+3];}while(++j<16&&alpha>0)
index-=flip?itemData.width*4:4;color=[itemData.data[index+0],itemData.data[index+1],itemData.data[index+2],itemData.data[index+3]];cubo=new facedPlane(faces.back,size,color,color);translate_solid([3- 5,4+ i*size- 16*size,-94+ 22*size- j*size],cubo);rotate_solid_x([0,0,-98],Math.PI/4,cubo);item.back.push(cubo);}}}
for(i=0;i<16;i++){alpha=0;j=0;while(j<16){do{index=flip?(j+ i*itemData.width)*4:(i+(15- j)*itemData.width)*4;alpha=itemData.data[index+3];}while(alpha==0&&++j<16)
if(alpha>0){color=[itemData.data[index+0],itemData.data[index+1],itemData.data[index+2],alpha];cubo=new facedPlane(faces.top,size,color,color);translate_solid([3- 5,4+ j*size- 17*size,-94+ 20*size- i*size],cubo);rotate_solid_x([0,0,-98],Math.PI/4,cubo);item.top.push(cubo);do{index=flip?(j+ i*itemData.width)*4:(i+(15- j)*itemData.width)*4;alpha=itemData.data[index+3];}while(++j<16&&alpha>0)
index+=flip?-4:itemData.width*4;color=[itemData.data[index+0],itemData.data[index+1],itemData.data[index+2],itemData.data[index+3]];cubo=new facedPlane(faces.bottom,size,color,color);translate_solid([3- 5,4+ j*size- 17*size,-94+ 20*size- i*size],cubo);rotate_solid_x([0,0,-98],Math.PI/4,cubo);item.bottom.push(cubo);}}}
return item;}
